{% extends 'base.html' %}

{% block content %}
<h1>Deployment Targets</h1>

<!-- Add Target Form -->
<div class="card mb-4">
    <div class="card-header">Add New Target</div>
    <div class="card-body">
        <form method="POST" class="row g-3">
            <div class="col-md-4">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="col-md-4">
                <label for="url" class="form-label">URL (with port)</label>
                <input type="text" class="form-control" id="url" name="url" placeholder="http://server:8080" required>
            </div>
            <div class="col-md-2">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status" name="status">
                    {% for status in TargetStatus %}
                    <option value="{{ status.name }}">{{ status.value }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-success w-100">Add Target</button>
            </div>
        </form>
    </div>
</div>

<!-- Targets List -->
<h3>Existing Targets</h3>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>URL</th>
            <th>Status</th>
            {% if g.user.role.name == 'admin' %}
            <th>Actions</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for target in targets %}
        <tr>
            <td>{{ target.name }}</td>
            <td><a href="{{ target.url }}" target="_blank">{{ target.url }}</a></td>
            <td>
                <form action="{{ url_for('toggle_target_status', target_id=target.id) }}" method="POST">
                    {% if target.status.name == 'available' %}
                    <button type="submit" class="btn btn-success btn-sm">Available (Click to Lock)</button>
                    {% else %}
                    <button type="submit" class="btn btn-danger btn-sm">Locked (Click to Unlock)</button>
                    {% endif %}
                </form>
            </td>
            {% if g.user.role.name == 'admin' %}
            <td>
                <form action="{{ url_for('delete_target', target_id=target.id) }}" method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this target?');">
                    <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                </form>
            </td>
            {% endif %}
        </tr>
        {% else %}
        <tr>
            <td colspan="3" class="text-center">No deployment targets found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}